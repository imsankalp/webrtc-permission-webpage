<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script  src="./adapter.js"></script>

</head>
<body>
    <h1 id="getLocation" style = 'text-align: center;'>One Card VKYC</h1>
    <video id="local" autoplay></video>
    <p id="giveCamPermission"></p>
    <p id="giveLocPermission"></p>
    <!-- <iframe src="https://webrtc.github.io/samples/src/content/devices/input-output/

    " title="checking" allow="camera; microphone"></iframe> -->

</body>
<script type="text/javascript">

var allPermissions = 0;

  function gotStream(stream) {
      window.AudioContext = window.AudioContext || window.webkitAudioContext;
      allPermissions +=1;
      var audioContext = new AudioContext();

      // Create an AudioNode from the stream
      var mediaStreamSource = audioContext.createMediaStreamSource(stream);

      // Connect it to destination to hear yourself
      // or any other node for processing!
      mediaStreamSource.connect(audioContext.destination);
      var video = document.querySelector('video');
      var videoTracks = stream.getVideoTracks();
      window.stream = stream; // make variable available to browser console
      video.srcObject = stream;
      getLocation();
  }

  function onfail(error) {
      console.log("permission not granted or system don't have media devices."+error.name);
      var showCamPermission = document.getElementById("giveCamPermission");
      showCamPermission.innerText = "Give Safari permission to access your camera and microphone";
  }

  function getLocation() {

    var getLocPermission = document.getElementById("giveLocPermission")
    //Fetch Location
    if (navigator.geolocation) {
      //If location found
      console.log("location found");
      allPermissions +=1;
      getLocPermission.innerText = "Loc Permission given";

      redirectToBank();
    } else { 
      //If location not found
      getLocPermission.innerText = "Give Permission to Safari Browser to allow location Access.";
      console.log("location NOT found");
  }
}

function redirectToBank(){
  window.location("https://wwww.google.com")
}



  navigator.mediaDevices.getUserMedia({audio:true,video:true})
    .then((stream) => {
      gotStream(stream);
    })
    .catch((error) => {
      onfail(error);
    });
  
</script>
</html>
